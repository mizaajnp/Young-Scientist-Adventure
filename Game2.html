<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 2: The Chaotic Experiment Room</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes bubble {
            0% {
                transform: translateY(0) scale(1);
                opacity: 0;
            }

            50% {
                opacity: 0.8;
            }

            100% {
                transform: translateY(-20px) scale(1.2);
                opacity: 0;
            }
        }

        .bubble {
            animation: bubble 1.5s ease-out infinite;
        }

        .flask-liquid {
            transition: height 1s linear;
        }

        .scientist-blink {
            animation: blink 4s infinite;
        }

        @keyframes blink {

            0%,
            45%,
            55%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }
        }

        .typewriter {
            overflow: hidden;
            border-right: .15em solid #4FD1C5;
            white-space: nowrap;
            letter-spacing: .15em;
            animation: typing 3.5s steps(40, end), blink-caret .75s step-end infinite;
        }

        @keyframes typing {
            from {
                width: 0
            }

            to {
                width: 100%
            }
        }

        @keyframes blink-caret {

            from,
            to {
                border-color: transparent
            }

            50% {
                border-color: #4FD1C5;
            }
        }

        .draggable {
            cursor: grab;
            transition: transform 0.1s;
        }

        .draggable:active {
            cursor: grabbing;
            transform: scale(1.05);
        }

        .drop-zone {
            min-height: 60px;
            transition: background-color 0.3s;
        }

        .drop-zone.highlight {
            background-color: rgba(129, 230, 217, 0.2);
        }

        .chemical-block {
            user-select: none;
        }

        .shake {
            animation: shake 0.5s;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            20%,
            60% {
                transform: translateX(-5px);
            }

            40%,
            80% {
                transform: translateX(5px);
            }
        }
    </style>
</head>

<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center p-4">
    <!-- Main Game Container -->
    <div class="w-full max-w-6xl bg-gray-800 rounded-xl shadow-2xl overflow-hidden border-2 border-teal-400 relative">
        <!-- Lab Background -->
        <div class="absolute inset-0 bg-gradient-to-b from-gray-900 to-blue-900 opacity-30"></div>

        <!-- Header -->
        <div class="relative z-10 bg-gray-700 p-4 border-b-2 border-teal-400 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-flask text-teal-400 text-2xl"></i>
                <h1 class="text-2xl font-bold text-teal-300">Chapter 2: The Chaotic Experiment Room</h1>
            </div>
            <div class="flex space-x-2">
                <button class="px-3 py-1 bg-teal-600 hover:bg-teal-500 rounded-lg transition">
                    <i class="fas fa-book"></i> Notes
                </button>
                <button class="px-3 py-1 bg-purple-600 hover:bg-purple-500 rounded-lg transition">
                    <i class="fas fa-cog"></i> Settings
                </button>
            </div>
        </div>

        <!-- Game Content -->
        <!-- ...existing code... -->
        <div class="relative z-10 p-6 flex flex-row flex-wrap gap-6">
            <!-- Left Side - Lab Scene -->
            <div
                class="w-1/2 min-w-[200px] bg-gray-700 rounded-lg p-4 border-2 border-blue-400 relative overflow-hidden min-h-96">
                <!-- ...Lab Scene... -->
            </div>
            <!-- Right Side - Drag & Drop Puzzle -->
            <div class="w-1/2 min-w-[200px] bg-gray-700 rounded-lg p-6 border-2 border-purple-400">
                <!-- ...Drag & Drop Puzzle... -->
            </div>
        </div>
        <!-- ...existing code... -->
        <!-- Chaotic Lab Background Elements -->
        <div class="absolute inset-0">
            <!-- Broken Glass -->
            <div class="absolute bottom-4 left-8 w-16 h-16 bg-gray-600 opacity-50 rounded-full"
                style="clip-path: polygon(0 0, 100% 0, 100% 60%, 60% 100%, 0 100%)"></div>
            <div class="absolute bottom-10 right-12 w-12 h-12 bg-gray-600 opacity-50"
                style="clip-path: polygon(50% 0%, 0% 100%, 100% 100%)"></div>

            <!-- Overturned Flask -->
            <div
                class="absolute top-16 right-8 w-10 h-16 bg-blue-400 bg-opacity-20 rounded-t-full border-2 border-blue-500 transform rotate-45 origin-bottom">
            </div>

            <!-- Notebook -->
            <div
                class="absolute bottom-16 left-12 w-24 h-32 bg-amber-100 bg-opacity-80 rounded-sm transform -rotate-6 shadow-lg">
                <div class="absolute top-2 left-2 right-2 bottom-2 bg-amber-50 bg-opacity-90 p-2 overflow-hidden">
                    <div class="text-xs font-bold text-gray-800 mb-1">Metal Reactions with Acids</div>
                    <div class="text-xs text-gray-700 font-mono mb-1">Mg + HCl → MgCl + H</div>
                    <div class="text-xxs text-gray-500 italic">"This reaction is unbalanced...<br>where did I go wrong?"
                    </div>
                </div>
            </div>

            <!-- Scientist Character -->
            <div class="absolute bottom-4 left-4">
                <div class="relative">
                    <div class="w-16 h-20 bg-white rounded-t-full flex flex-col items-center">
                        <!-- Lab Coat -->
                        <div class="w-full h-4/5 bg-white rounded-t-full border-b-2 border-gray-300"></div>
                        <!-- Face -->
                        <div
                            class="absolute top-4 left-1/2 transform -translate-x-1/2 w-10 h-10 bg-amber-100 rounded-full flex flex-col items-center scientist-blink">
                            <!-- Glasses -->
                            <div class="absolute top-2 w-full flex justify-center space-x-1">
                                <div class="w-4 h-2 bg-blue-200 rounded-full border border-blue-400"></div>
                                <div class="w-4 h-2 bg-blue-200 rounded-full border border-blue-400"></div>
                            </div>
                            <div class="absolute top-3 w-8 h-0.5 bg-gray-400"></div>
                            <!-- Eyes -->
                            <div class="absolute top-4 w-full flex justify-center space-x-4">
                                <div class="w-1 h-1 bg-black rounded-full"></div>
                                <div class="w-1 h-1 bg-black rounded-full"></div>
                            </div>
                            <!-- Mouth -->
                            <div class="absolute top-6 w-4 h-1 bg-black rounded-full"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bubbles -->
            <div class="absolute w-full h-full">
                <div class="bubble absolute w-4 h-4 bg-blue-400 rounded-full"
                    style="left: 20%; bottom: 10%; animation-delay: 0s;"></div>
                <div class="bubble absolute w-3 h-3 bg-blue-300 rounded-full"
                    style="left: 50%; bottom: 15%; animation-delay: 0.5s;"></div>
                <div class="bubble absolute w-5 h-5 bg-teal-300 rounded-full"
                    style="left: 70%; bottom: 5%; animation-delay: 1s;"></div>
            </div>
        </div>
    </div>

    <!-- Right Side - Drag & Drop Puzzle -->
    <div class="w-full md:w-1/2 bg-gray-700 rounded-lg p-6 border-2 border-purple-400">
        <div class="mb-6">
            <h2 class="text-xl font-bold text-purple-300 mb-2">Balance the Chemical Reaction</h2>
            <div class="bg-gray-800 p-4 rounded-lg border-l-4 border-yellow-400">
                <div class="flex items-start">
                    <div class="text-yellow-300 mr-3 mt-1">
                        <i class="fas fa-quote-left"></i>
                    </div>
                    <div>
                        <p class="italic text-sm">"Balance the reaction correctly to proceed. Only true chemists may
                            pass."</p>
                        <p class="text-right text-xs text-gray-400 mt-1">— Mechanical Voice</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Drop Zones for Equation -->
        <div class="mb-6">
            <div class="text-sm text-gray-400 mb-2">Drag elements to build the balanced equation:</div>
            <div class="flex flex-wrap gap-2 mb-4" id="equation-slots">
                <!-- These will be filled by dragged elements -->
                <div class="drop-zone flex-1 min-w-[60px] bg-gray-800 rounded-lg border-2 border-dashed border-gray-600 flex items-center justify-center"
                    data-slot="1"></div>
                <div class="drop-zone flex-1 min-w-[60px] bg-gray-800 rounded-lg border-2 border-dashed border-gray-600 flex items-center justify-center"
                    data-slot="2"></div>
                <div class="drop-zone flex-1 min-w-[60px] bg-gray-800 rounded-lg border-2 border-dashed border-gray-600 flex items-center justify-center"
                    data-slot="3"></div>
                <div class="drop-zone flex-1 min-w-[60px] bg-gray-800 rounded-lg border-2 border-dashed border-gray-600 flex items-center justify-center"
                    data-slot="4"></div>
                <div class="drop-zone flex-1 min-w-[60px] bg-gray-800 rounded-lg border-2 border-dashed border-gray-600 flex items-center justify-center"
                    data-slot="5"></div>
            </div>

            <!-- Current Equation Display -->
            <div class="bg-gray-800 p-3 rounded-lg mb-4">
                <div class="text-center text-xl font-mono" id="current-equation">
                    <span class="text-gray-500">Empty slots...</span>
                </div>
            </div>
        </div>

        <!-- Draggable Elements -->
        <div class="mb-6">
            <div class="text-sm text-gray-400 mb-2">Available elements:</div>
            <div class="flex flex-wrap gap-2" id="draggable-elements">
                <div class="draggable chemical-block px-4 py-2 bg-blue-600 rounded-lg border border-blue-400"
                    draggable="true" data-value="Mg">Mg</div>
                <div class="draggable chemical-block px-4 py-2 bg-blue-600 rounded-lg border border-blue-400"
                    draggable="true" data-value="HCl">HCl</div>
                <div class="draggable chemical-block px-4 py-2 bg-blue-700 rounded-lg border border-blue-500"
                    draggable="true" data-value="2HCl">2HCl</div>
                <div class="draggable chemical-block px-4 py-2 bg-purple-600 rounded-lg border border-purple-400"
                    draggable="true" data-value="MgCl₂">MgCl₂</div>
                <div class="draggable chemical-block px-4 py-2 bg-purple-600 rounded-lg border border-purple-400"
                    draggable="true" data-value="H₂">H₂</div>
                <div class="draggable chemical-block px-4 py-2 bg-gray-600 rounded-lg border border-gray-500"
                    draggable="true" data-value="+">+</div>
                <div class="draggable chemical-block px-4 py-2 bg-gray-600 rounded-lg border border-gray-500"
                    draggable="true" data-value="→">→</div>
            </div>
        </div>

        <!-- Controls -->
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <div class="relative w-12 h-20 mr-3">
                    <!-- Flask Glass -->
                    <div class="absolute inset-0 bg-blue-900 bg-opacity-20 rounded-b-full border-2 border-blue-400">
                    </div>
                    <!-- Liquid -->
                    <div id="timer-liquid"
                        class="absolute bottom-0 left-0 right-0 bg-blue-500 rounded-b-full flask-liquid"
                        style="height: 100%;"></div>
                </div>
                <div>
                    <div class="text-xs text-gray-400">TIME REMAINING</div>
                    <div id="timer" class="text-xl font-mono">01:40</div>
                </div>
            </div>
            <div class="flex space-x-2">
                <button id="hint-btn" class="px-4 py-2 bg-yellow-600 hover:bg-yellow-500 rounded-lg transition">
                    <i class="fas fa-lightbulb mr-2"></i>Hint
                </button>
                <button id="check-btn" class="px-4 py-2 bg-green-600 hover:bg-green-500 rounded-lg transition">
                    <i class="fas fa-check mr-2"></i>Check
                </button>
                <button id="reset-btn" class="px-4 py-2 bg-red-600 hover:bg-red-500 rounded-lg transition">
                    <i class="fas fa-redo mr-2"></i>Reset
                </button>
            </div>
        </div>
    </div>
    </div>

    <!-- Footer -->
    <div class="relative z-10 bg-gray-700 p-3 text-center text-sm text-gray-400 border-t-2 border-teal-400">
        <div class="typewriter">Legendary Laboratory of Professor Marie Curion - Balance the reaction to proceed...
        </div>
    </div>

    <!-- Modal for Correct Answer -->
    <div id="correct-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-xl p-6 max-w-sm w-full border-2 border-green-400 relative">
            <div
                class="absolute -top-4 -right-4 bg-green-500 w-12 h-12 rounded-full flex items-center justify-center text-2xl">
                <i class="fas fa-check"></i>
            </div>
            <h3 class="text-2xl font-bold text-green-400 mb-3">Perfectly Balanced!</h3>
            <p class="mb-4">The reaction glows brightly as you hear a mechanical click. A hidden drawer slides open
                revealing a faded laboratory map...</p>
            <div class="flex justify-center">
                <button onclick="nextChapter()" class="px-6 py-2 bg-green-600 hover:bg-green-500 rounded-lg transition">
                    Continue <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal for Wrong Answer -->
    <div id="wrong-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-xl p-6 max-w-sm w-full border-2 border-red-400 relative">
            <div
                class="absolute -top-4 -right-4 bg-red-500 w-12 h-12 rounded-full flex items-center justify-center text-2xl">
                <i class="fas fa-times"></i>
            </div>
            <h3 class="text-2xl font-bold text-red-400 mb-3">Not Quite Right!</h3>
            <p class="mb-4" id="wrong-message">The equation remains unbalanced. Remember the Law of Conservation of
                Mass!</p>
            <div class="flex justify-center">
                <button onclick="closeWrongModal()" class="px-6 py-2 bg-red-600 hover:bg-red-500 rounded-lg transition">
                    Try Again <i class="fas fa-redo ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Hint Modal -->
    <div id="hint-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-xl p-6 max-w-sm w-full border-2 border-yellow-400 relative">
            <div
                class="absolute -top-4 -right-4 bg-yellow-500 w-12 h-12 rounded-full flex items-center justify-center text-2xl">
                <i class="fas fa-lightbulb"></i>
            </div>
            <h3 class="text-2xl font-bold text-yellow-400 mb-3">Reaction Hint</h3>
            <p class="mb-4">Magnesium reacts with hydrochloric acid to produce magnesium chloride and hydrogen gas:</p>
            <div class="bg-gray-700 p-3 rounded-lg mb-4">
                <p class="text-sm font-mono text-center">Mg + HCl → MgCl₂ + H₂</p>
                <p class="text-xs text-gray-400 text-center mt-1">Count the atoms on both sides to balance properly</p>
            </div>
            <div class="flex justify-center">
                <button onclick="closeHintModal()"
                    class="px-6 py-2 bg-yellow-600 hover:bg-yellow-500 rounded-lg transition">
                    Got It! <i class="fas fa-thumbs-up ml-2"></i>
                </button>
            </div>
        </div>
    </div>
    </div>

    <script>
        // Game state
        let timeLeft = 100; // 100 seconds
        let timerInterval;
        const correctAnswer = ['Mg', '2HCl', '→', 'MgCl₂', 'H₂'];
        let currentEquation = Array(5).fill(null);

        // Start the timer when page loads
        document.addEventListener('DOMContentLoaded', function () {
            startTimer();
            setupDragAndDrop();
        });

        // Timer functions
        function startTimer() {
            updateTimerDisplay();
            timerInterval = setInterval(function () {
                timeLeft--;
                updateTimerDisplay();

                // Update flask liquid
                const liquidHeight = (timeLeft / 100) * 100;
                document.getElementById('timer-liquid').style.height = `${liquidHeight}%`;

                // Change color when time is running low
                if (timeLeft <= 30) {
                    document.getElementById('timer-liquid').classList.remove('bg-blue-500');
                    document.getElementById('timer-liquid').classList.add('bg-red-500');
                }

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    showWrongAnswer("Time's up! The equation wasn't balanced in time.");
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent =
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Drag and Drop Setup
        function setupDragAndDrop() {
            const draggables = document.querySelectorAll('.draggable');
            const dropZones = document.querySelectorAll('.drop-zone');

            // Add event listeners to draggable elements
            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', dragStart);
                draggable.addEventListener('dragend', dragEnd);
            });

            // Add event listeners to drop zones
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', dragOver);
                zone.addEventListener('dragenter', dragEnter);
                zone.addEventListener('dragleave', dragLeave);
                zone.addEventListener('drop', drop);
            });

            // Check button
            document.getElementById('check-btn').addEventListener('click', checkEquation);

            // Reset button
            document.getElementById('reset-btn').addEventListener('click', resetEquation);
        }

        // Drag and Drop Functions
        function dragStart() {
            this.classList.add('opacity-50');
            draggedElement = this;
            setTimeout(() => this.classList.add('hidden'), 0);
        }

        function dragEnd() {
            this.classList.remove('opacity-50', 'hidden');
        }

        function dragOver(e) {
            e.preventDefault();
        }

        function dragEnter(e) {
            e.preventDefault();
            this.classList.add('highlight');
        }

        function dragLeave() {
            this.classList.remove('highlight');
        }

        function drop() {
            this.classList.remove('highlight');

            // Get the slot number
            const slot = parseInt(this.dataset.slot) - 1;

            // If there's already an element in this slot, return it to the pool
            if (currentEquation[slot]) {
                returnElementToPool(currentEquation[slot]);
            }

            // Add the new element to the slot
            const elementValue = draggedElement.dataset.value;
            currentEquation[slot] = elementValue;

            // Create a clone of the dragged element
            const clone = draggedElement.cloneNode(true);
            clone.classList.remove('draggable', 'opacity-50', 'hidden');
            clone.removeAttribute('draggable');
            clone.dataset.original = draggedElement.dataset.value;

            // Add remove button
            const removeBtn = document.createElement('button');
            removeBtn.innerHTML = '<i class="fas fa-times text-xs"></i>';
            removeBtn.className = 'absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-4 h-4 flex items-center justify-center opacity-0 hover:opacity-100 transition';
            removeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                returnElementToPool(elementValue);
                this.innerHTML = '';
                currentEquation[slot] = null;
                updateEquationDisplay();
            });

            clone.appendChild(removeBtn);
            this.innerHTML = '';
            this.appendChild(clone);

            updateEquationDisplay();
        }

        function returnElementToPool(value) {
            const element = document.querySelector(`.draggable[data-value="${value}"]`);
            if (element) {
                element.classList.remove('hidden');
            }
        }

        function updateEquationDisplay() {
            const equationDisplay = document.getElementById('current-equation');
            const equationString = currentEquation.filter(Boolean).join(' ') || '<span class="text-gray-500">Empty slots...</span>';
            equationDisplay.innerHTML = equationString;
        }

        // Equation Checking
        function checkEquation() {
            clearInterval(timerInterval);

            // Get the current equation as an array
            const userAnswer = currentEquation.filter(Boolean);

            // Check if the answer is correct
            if (arraysEqual(userAnswer, correctAnswer)) {
                showCorrectAnswer();
            } else {
                let message = "The equation isn't balanced correctly. Try again!";

                // Check for common mistakes
                if (!userAnswer.includes('2HCl')) {
                    message = "You need 2 HCl molecules to balance the hydrogen atoms!";
                } else if (!userAnswer.includes('MgCl₂')) {
                    message = "Magnesium chloride is MgCl₂, not MgCl!";
                } else if (!userAnswer.includes('H₂')) {
                    message = "Hydrogen gas is H₂, not H!";
                }

                showWrongAnswer(message);
            }
        }

        function arraysEqual(a, b) {
            if (a.length !== b.length) return false;
            for (let i = 0; i < a.length; i++) {
                if (a[i] !== b[i]) return false;
            }
            return true;
        }

        function resetEquation() {
            // Clear all drop zones
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.innerHTML = '';
            });

            // Return all elements to pool
            currentEquation.forEach(value => {
                if (value) returnElementToPool(value);
            });

            // Reset current equation
            currentEquation = Array(5).fill(null);
            updateEquationDisplay();

            // Reset timer if needed
            if (timeLeft <= 0) {
                timeLeft = 100;
                startTimer();
                document.getElementById('timer-liquid').classList.remove('bg-red-500');
                document.getElementById('timer-liquid').classList.add('bg-blue-500');
            }
        }

        // Modal Functions
        function showCorrectAnswer() {
            document.getElementById('correct-modal').classList.remove('hidden');
            // Play success sound
            const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3');
            audio.play();
        }

        function showWrongAnswer(message) {
            document.getElementById('wrong-message').textContent = message;
            document.getElementById('wrong-modal').classList.remove('hidden');
            // Play error sound
            const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3');
            audio.play();

            // Shake the equation slots
            const slots = document.getElementById('equation-slots');
            slots.classList.add('shake');
            setTimeout(() => slots.classList.remove('shake'), 500);
        }

        function closeWrongModal() {
            document.getElementById('wrong-modal').classList.add('hidden');
            // Reset timer
            timeLeft = 100;
            startTimer();
            document.getElementById('timer-liquid').classList.remove('bg-red-500');
            document.getElementById('timer-liquid').classList.add('bg-blue-500');
        }

        // Hint modal
        document.getElementById('hint-btn').addEventListener('click', function () {
            document.getElementById('hint-modal').classList.remove('hidden');
        });

        function closeHintModal() {
            document.getElementById('hint-modal').classList.add('hidden');
        }

        // Next chapter function
        function nextChapter() {
            window.location.href = "Game3.html";
        }
    </script>
</body>

</html>
